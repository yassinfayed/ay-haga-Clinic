![Logo](https://flowbite.com/docs/images/logo.svg)

![Mongo DB](https://img.shields.io/badge/MongoDB-4EA94B?style=for-the-badge&logo=mongodb&logoColor=white)![Expree.js](https://img.shields.io/badge/Express.js-404D59?style=for-the-badge)![React](https://img.shields.io/badge/React-20232A?style=for-the-badge&logo=react&logoColor=61DAFB) ![Node.JS](https://img.shields.io/badge/Node.js-43853D?style=for-the-badge&logo=node.js&logoColor=white) ![Redux](https://img.shields.io/badge/Redux-593D88?style=for-the-badge&logo=redux&logoColor=white) ![Tailwind](https://img.shields.io/badge/Tailwind_CSS-38B2AC?style=for-the-badge&logo=tailwind-css&logoColor=white) ![Stripe](https://img.shields.io/badge/Stripe-626CD9?style=for-the-badge&logo=Stripe&logoColor=white) ![VS code](https://img.shields.io/badge/Visual_Studio_Code-0078D4?style=for-the-badge&logo=visual%20studio%20code&logoColor=white)

# Vite Clinics

Vite Clinics is an innovative virtual healthcare platform designed to revolutionize the patient and healthcare provider experience in Egypt. By leveraging the power of digital technology, Vite Clinics facilitates a comprehensive suite of services for both doctors and patients through an accessible online portal. The platform's primary aim is to streamline the process of healthcare delivery by offering a range of functionalities from appointment scheduling to telemedicine consultations.

## Motivation

The motivation behind Vite Clinics stems from the need to improve healthcare accessibility and convenience in today's fast-paced world. Challenges such as extended wait times, travel constraints, and the difficulty of managing health records and prescriptions are addressed head-on with Vite Clinics. The platform is crafted to empower patients with immediate access to healthcare services and information, while providing doctors with a robust tool to manage their practice efficiently. The motivation is further driven by the goal to digitize health records, making them easily accessible, and to facilitate seamless communication between patients and healthcare providers.

## Build Status

Passing - All tests successful as of 16/12/2023.
- The project is currently in development.
- The development team is utilizing GitHub for version control
- To ensure a structured and organized development process, we have adopted the GitFlow workflow.

## Code Style

### Formatting:

- Prettier: we use Prettier as an opinionated code formatter. It enforces a consistent style by parsing code and re-printing it with its own rules that take the maximum line length into account, wrapping code when necessary.

### Code Reviews:

- Pull Requests: All code changes are submitted through pull requests on GitHub, which are then reviewed by peers. This process ensures adherence to our coding standards and allows for collective ownership of the code.

### Consistency:

- Naming Conventions: We use clear, meaningful variable and function names, following camelCase for JavaScript variables and functions, PascalCase for React component names, UPPER_SNAKE_CASE for constants, and kebab-case for css classes.

- File Structure: We maintain a logical file structure, grouping related files in dedicated folders, and following a consistent naming convention for files and directories.

## Screenshots ðŸ–µ


<details>
<summary>Landing Page</summary>
![image](https://github.com/advanced-computer-lab-2023/ay-haga-Clinic/assets/105674844/f0457fe6-fda3-4d57-8d07-fda5d523edc2)
![Screenshot 2023-12-16 204206](https://github.com/advanced-computer-lab-2023/ay-haga-Clinic/assets/105674844/1d4df9df-3d2f-47ee-9357-3610afb2a0f4)

</details>

<details>
<summary>Login Page</summary>
![Screenshot 2023-12-16 204239](https://github.com/advanced-computer-lab-2023/ay-haga-Clinic/assets/105674844/98380a4e-ccbf-48c7-94d7-1b0953690f7b)

</details>

<details>
<summary>Patient Profile Page</summary>
![Screenshot 2023-12-16 204402](https://github.com/advanced-computer-lab-2023/ay-haga-Clinic/assets/105674844/29dde6b5-6463-4c81-b1ef-71ddd44b283d)

</details>

<details>
<summary>Family Members' Page</summary>
![Screenshot 2023-12-16 204510](https://github.com/advanced-computer-lab-2023/ay-haga-Clinic/assets/105674844/dd7f3709-3ea0-48e9-b5ce-ed2880875c82)

</details>

<details>
<summary>Doctor's Contract Page</summary>
![Screenshot 2023-12-16 204844](https://github.com/advanced-computer-lab-2023/ay-haga-Clinic/assets/105674844/80060872-491a-4072-aae3-d6dc99d4a0bf)

</details>

<details>
<summary>Doctor's Profile Page</summary>
![Screenshot 2023-12-16 204906](https://github.com/advanced-computer-lab-2023/ay-haga-Clinic/assets/105674844/1dc1920c-84a3-438e-bae4-78f5dcb80f86)

</details>

<details>
<summary>Sign up Page</summary>
![Screenshot 2023-12-16 204953](https://github.com/advanced-computer-lab-2023/ay-haga-Clinic/assets/105674844/c4b7e758-25ab-437a-8288-452aa3531113)

</details>

<details>
<summary>Adding A New Family Member</summary>
![Screenshot 2023-12-16 205702](https://github.com/advanced-computer-lab-2023/ay-haga-Clinic/assets/105674844/6936fbd4-ac8b-498f-b7ba-072ed871b3b9)

</details>

<details>
<summary>Health Packages Page</summary>
![Screenshot 2023-12-16 205917](https://github.com/advanced-computer-lab-2023/ay-haga-Clinic/assets/105674844/97824627-c0b0-41e2-9037-b6bdcd9272dd)

</details>

<details>
<summary>Manage User Page For Admin</summary>
![Screenshot 2023-12-16 210337](https://github.com/advanced-computer-lab-2023/ay-haga-Clinic/assets/105674844/309def71-64db-4687-8916-c69be1027d15)
![Screenshot 2023-12-16 210407](https://github.com/advanced-computer-lab-2023/ay-haga-Clinic/assets/105674844/e9be64a9-7aa6-47d2-b31b-f3d56b6e72f1)

</details>


## Tech/Framework Used

### MERN stack (MongoDB, Express.js, React, Node.js)

- [React](https://reactjs.org/)
- [Node.js](https://nodejs.org/en/)
- [Express](https://expressjs.com/)
- [MongoDB](https://www.mongodb.com/)
<details>
    <summary>Other technologies used</summary>
 

- [Mongoose](https://mongoosejs.com/)
- [Redux](https://redux.js.org/)
- [Tailwind CSS](https://tailwindcss.com/)
- [Stripe](https://stripe.com/)
- [Javascript](https://www.javascript.com/)
- [Github](https://github.com/)
- [Mailjet](https://www.mailjet.com/)
- [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
- [Postman](https://www.postman.com/)
- [VSCode](https://code.visualstudio.com/)
- [tremor](https://www.tremor.so/)
- [axios](https://www.npmjs.com/package/axios)
- [Mailtrap](https://mailtrap.io/)
- [Archiver](https://www.npmjs.com/package/archiver)
- [bcryptjs](https://www.npmjs.com/package/bcryptjs)
- [Compression](https://www.npmjs.com/package/compression)
- [Cookie-parser](https://www.npmjs.com/package/cookie-parser)
- [CORS](https://www.npmjs.com/package/cors)
- [dotenv](https://www.npmjs.com/package/dotenv)
- [Express Mongo Sanitize](https://www.npmjs.com/package/express-mongo-sanitize)
- [Express Rate Limit](https://www.npmjs.com/package/express-rate-limit)
- [Express Validator](https://express-validator.github.io/docs/)
- [Helmet](https://helmetjs.github.io/)
- [hpp](https://www.npmjs.com/package/hpp)
- [html-to-text](https://www.npmjs.com/package/html-to-text)
- [jsonwebtoken](https://www.npmjs.com/package/jsonwebtoken)
- [Morgan](https://www.npmjs.com/package/morgan)
- [Multer](https://www.npmjs.com/package/multer)
- [Node-Mailjet](https://www.npmjs.com/package/node-mailjet)
- [Nodemailer](https://nodemailer.com/)
- [Nodemon](https://nodemon.io/)
- [PDFKit](https://pdfkit.org/)
- [Pug](https://pugjs.org/api/getting-started.html)
- [Sharp](https://sharp.pixelplumbing.com/)
- [Slugify](https://www.npmjs.com/package/slugify)
- [Socket.IO](https://socket.io/)
- [Validator](https://www.npmjs.com/package/validator)
- [XSS-clean](https://www.npmjs.com/package/xss-clean)
- [Material-UI](https://material-ui.com/)
- [i18next](https://www.i18next.com/)
- [React Bootstrap](https://react-bootstrap.github.io/)
- [React Cookie](https://www.npmjs.com/package/react-cookie)
- [React Router DOM](https://reactrouter.com/)
- [React Scripts](https://create-react-app.dev/docs/adding-a-css-preprocessor/)
- [Web Vitals](https://web.dev/vitals/)

</details>

## Features

<details>
<summary>For Admins </summary>

- User Management: Ability to view, add, and manage all users on the platform, including patients, doctors, and other admins. Admins also can delete user accounts when necessary.
- Doctor Approval and Management: Oversee doctor registrations and grant approvals for new doctors joining the clinic. Admins have the ability to accept or reject doctors, including the handling of employment contracts, and Access to view and manage all doctors' details, including specializations, qualifications, and availability.
- Patient Oversight: Monitor and manage patient accounts, and have Access to view all registered patients and their medical records, appointments, and health package subscriptions.
- Appointment Management: Oversee all appointments scheduled in the clinic. Ability to view, reschedule, or cancel appointments as required for operational efficiency.
- Health Package Management: Create, update, and manage health packages offered by the clinic. Set pricing, features, and terms for each health package.
- Prescription Oversight: Monitor and manage the prescription records within the clinic. Access to all prescription details, including medication, dosage, and doctor's notes.
- Notifications and Alerts: Manage and oversee the notification system. Ensure timely and accurate delivery of notifications to patients, doctors, and other relevant parties.
- Reporting and Analytics: Access to comprehensive reports and analytics tools. Ability to generate reports on clinic operations, user activities, financial metrics, and other key performance indicators.
- Security and Data Privacy: Ensure the security and confidentiality of all user data on the platform. Implement and oversee data privacy policies in compliance with healthcare regulations.
- Feedback and Complaints Management: Address and manage feedback and complaints from users. Implement measures to improve user satisfaction and service quality.
</details>

<details>
<summary>For Doctors: </summary>

- Profile Management: Doctors can update personal information, including email, hourly rates, and hospital affiliations.
- Employment Contract Management: The ability to view and accept employment contracts digitally.
- Scheduling: Doctors can add available time slots for patient appointments.
- Patient Management: Features include viewing patient information, health records filtering patients by various criteria, and managing follow-ups.
- Appointment Management: Doctors can view, accept, filter, reschedule, and cancel appointments.
- Prescription Management: The platform allows the addition, deletion, and updating of medicines and dosages on prescriptions. Doctors can also download prescriptions in PDF format.
- Health Records: Input new health records for patients, ensuring all medical information is up-to-date and easily accessible.
</details>

<details>
<summary>For Patients: </summary>

- Appointment Management: Patients can filter appointments by date and status, view upcoming and past appointments, and manage cancellations and rescheduling.
- Health Record Access: Patients have access to their health records and prescriptions, with the ability to download them.
- Telemedicine: The platform supports video calls and chats with doctors, offering a real-time telemedicine experience.
- Health Packages: Patients can subscribe and unsubscribe to health packages which gives them discounts on appointments for them and their family members.
- Family Member Linking: Patients can add new family member or link existing patient as their own family member.
- Family Member Management: Patients can manage appointments, and Health Packages for themselves and linked family members, enhancing the platform's convenience.
</details>

<details>
<summary> Common Features for Doctors and Patients:</summary>

- Notifications: Both parties receive notifications of appointments and changes to them via the system and email.
- Communication: A chat feature is available for instant communication between patients and doctors.
- Appointment Filtering: Both roles can filter appointments by various criteria, including date and status.
- Wallet Management: Users can view the amount in their wallet, which for patients could include funds for services, and for doctors, represent earnings.

</details>

## Code Examples

<details>
    
<summary> User Login </summary>

```javascript
exports.login = catchAsync(async (req, res, next) => {
  const { username, password } = req.body;

  if (!username || !password) {
    return next(new AppError("Please provide a username and a password", 400));
  }
  const user = await User.findOne({ username }).select("+password");

  if (!user || !(await user.correctPassword(password, user.password))) {
    return next(new AppError("Invalid Credentials", 401));
  }
  const doct = await Doctor.find({ user: user._id });
  if (user.role === enums.ROLE.DOCTOR && doct.isApproved === false) {
    return next(new AppError("Doctor is not approved", 400));
  }

  if (user.role === "doctor") {
    const doc = await Doctor.findOne({ user: user._id });
    user.doctor = doc;
  } else if (user.role === "patient") {
    const pat = await Patient.findOne({ user: user._id });
    user.patient = pat;
  }

  createSendToken(user, 200, req, res);
});
```

</details>

<details>
    
<summary> Appointment Cancellation </summary>

```javascript
exports.cancelAppointment = catchAsync(async (req, res, next) => {
  const appointment = await Appointment.findByIdAndUpdate(
    req.params.id,
    { status: "Cancelled" },
    {
      new: true,
    }
  )
    .populate("doctorId")
    .exec();
  const currentDate = new Date();
  const timeDifference = appointment.date.getTime() - currentDate.getTime();
  const hoursDifference = timeDifference / (1000 * 60 * 60);
  const patient = await Patient.findById(appointment.patientId);
  const userP = await User.findById(patient.user);
  const { doctorId } = await Appointment.findByIdAndUpdate(req.params.id);
  const doctor = await Doctor.findById(doctorId);
  const userD = await User.findById(appointment.doctorId.user);
  if (hoursDifference > 24 || req.user.role == "doctor") {
    userP.wallet += appointment.doctorId?.HourlyRate;
    await userP.save({ validateBeforeSave: false });

    userD.wallet -= appointment.doctorId?.HourlyRate;
    await userD.save({ validateBeforeSave: false });
  }

  doctor.availableDates.push(appointment.date);
  await doctor.save({ validateBeforeSave: false });

  res.status(200).json({
    status: "success",
    results: 1,
    data: {
      data: appointment,
    },
  });

  await new Email(patient).cancel(appointment.date, "Cancelled");
  await new Email(doctor).cancel(appointment.date, "Cancelled");

  const newNotification = new Notification({
    title: "Appointment Cancelled",
    text: "Your appointment with dr." + doctor?.name + " has been cancelled",
    user: userP?._id,
  });

  const newNotification2 = new Notification({
    title: "Appointment Cancelled",
    text:
      "Your appointment with patient" + patient?.name + " has been cancelled",
    user: userD?._id,
  });

  await newNotification.save();
  await newNotification2.save();
});
```

</details>

<details>
    
<summary> Family Member Linking </summary>

```javascript
exports.linkFamilyMember = catchAsync(async (req, res, next) => {
  const { phone, relationToPatient, email } = req.body;
  const patient = await Patient.findOne({ user: req.user._id });
  let familymemberaspatient;
  if (email) {
    familymemberaspatient = await Patient.findOne({ email: email });
  }
  if (phone) {
    familymemberaspatient = await Patient.findOne({
      mobileNumber: phone,
    });
  }
  if (!familymemberaspatient) {
    return next(
      new AppError("No Patient found with that email or phone number", 404)
    );
  }
  const patientId = patient._id;
  const familyMemberId = familymemberaspatient._id;

  // Create a new family member instance using the Mongoose model
  const familyMember = new FamilyMember({
    name: familymemberaspatient.name,
    age: familymemberaspatient.age,
    gender: familymemberaspatient.gender,
    relationToPatient,
    patientId: patientId,
    linkedPatientId: familyMemberId,
  });

  // Save the family member to the database
  await familyMember.save();

  // Respond with a success message
  res.status(200).json({
    status: "success",
    data: {
      data: familyMember,
    },
  });
});
```

</details>

<details>
    
<summary> Downloading And Checking Prescription </summary>

```javascript
exports.downloadPrescription = catchAsync(async (req, res, next) => {
  try {
    const prescriptionId = req.params.id;
    const prescription = await Prescription.findById(prescriptionId).populate(
      "patient doctor"
    );

    if (!prescription) {
      return res.status(404).json({ error: "Prescription not found" });
    }

    const pdfDoc = new PDFDocument();
    const filename = `prescription_${prescriptionId}.pdf`;

    res.setHeader("Content-Type", "application/pdf");
    res.setHeader("Content-Disposition", `attachment; filename="${filename}"`);

    pdfDoc.pipe(res);

    pdfDoc.text(`Prescription Date: ${prescription.prescriptionDate}`);

    prescription.medicines.forEach((medicine, index) => {
      pdfDoc.text(`Medicine ${index + 1}: ${medicine.medicine}`);
      pdfDoc.text(`Dosage: ${medicine.dosage}`);
      pdfDoc.text(`Frequency: ${medicine.frequency}`);
      pdfDoc.text(`Start Date: ${medicine.startDate}`);
      pdfDoc.text(`End Date: ${medicine.endDate || "N/A"}`);
      pdfDoc.moveDown();
    });

    pdfDoc.text(`Instructions: ${prescription.instructions || "N/A"}`);
    pdfDoc.text(
      `Filled/Unfilled: ${prescription.filled_unfilled ? "Filled" : "Unfilled"}`
    );

    pdfDoc.end();
  } catch (error) {
    console.error(error);
    res.status(500).json({ error: "Internal Server Error" });
  }
});

exports.checkPrescr = catchAsync(async (req, res, next) => {
  const user = await User.findOne({ username: req.body.username });
  const patient = await Patient.findOne({ user: user._id });
  const name = req.body.medicine;
  const prescription = await Prescription.findOne({
    patientId: patient._id,
    "medicines.medicine": name,
    filled_unfilled: false,
  });

  if (!prescription) {
    return res.status(404).json({ error: "Prescription not found" });
  } else {
    prescription.filled_unfilled = true;
    await prescription.save({ validateBeforeSave: false });
    return res.status(200).json({ message: "Prescription found" });
  }
});
```

</details>

<details>
    
<summary> FamilyMember Routes </summary>

```javascript
router.use(authController.protect);
router.post(
  "/link",
  authController.restrictTo("patient"),
  familyMemberController.linkFamilyMember
);
router.post(
  "/",
  authController.restrictTo("patient"),
  familyMemberController.addFamilyMembers,
  authController.signup
);
router
  .route("/")
  .get(
    authController.restrictTo("patient"),
    familyMemberController.viewRegisteredFamilyMembers
  );
router.get(
  "/view-all-family-members",
  familyMemberController.viewAllFamilyMembersAndPatients
);
```

</details>

<details>
    
<summary> Modal </summary>

```javascript
<div
  style={{
    position: "absolute",
    width: "100vw",
    height: "100vmax",
    top: 0,
    left: 0,
    background: "rgba(0,0,0,0.75)",
    zIndex: 49,
    display: visible ? "block" : "none",
  }}
>
  <div
    style={{
      display: "flex",
      position: "fixed",
      top: "50%",
      left: "50%",
      transform: "translate(-50%, -50%)",
      minWidth: "500px",
      minHeight: `${famFlag ? "50px" : "500px"}`,
      zIndex: 50,
    }}
  >
    <Card className="flex flex-col flex-1 grow">
      <div className="flex flex-row w-100">
        <div
          role="button"
          onClick={() => setVisible(false)}
          className="ms-auto"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
            className="w-6 h-6"
          >
            <path
              fillRule="evenodd"
              d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z"
              clipRule="evenodd"
            />
          </svg>
        </div>
      </div>
      {children}
    </Card>
  </div>
</div>
```

</details>

<details>
    
<summary> Link Existing Family Member Component </summary>

```javascript
import React, { useState, useEffect } from "react";
import { useDispatch, useSelector } from "react-redux";
import { LinkFamilyMember } from "@/app/redux/actions/FamilyMembersAction";
import { Button, TextInput, Select, SelectItem } from "@tremor/react";

import { validateEmail, validatePhoneNumber } from "../../redux/validators";
import { Modal } from "../../../components/Modal"; // Your custom Modal component
import Lottie from "lottie-react";
import LoadingAnimation from "../../../../public/loading.json";

function LinkFamily({ show, setSuccess, setError, visible, setVisible }) {
  const [cred, setCred] = useState("");
  const [relationToPatient, setRelationToPatient] = useState("");
  const [calloutVisible, setCalloutVisible] = useState(false);
  const [calloutMessage, setCalloutMessage] = useState("");
  const { error, loading, familyMember } = useSelector(
    (state) => state.linkFamilyMemberReducer,
  );
  const [submitted, setSubmitted] = useState(false);
  const dispatch = useDispatch();

  const isValidCred = (cred) => {
    return validateEmail(cred) || validatePhoneNumber(cred);
  };
  console.log(visible);
  const handleSubmit = (e) => {
    e.preventDefault();
    let phone, email;

    if (validateEmail(cred)) {
      email = cred;
    } else if (validatePhoneNumber(cred)) {
      phone = cred;
    } else {
      console.log("Invalid email or phone number");
      return;
    }
    console.log(email, phone, relationToPatient);

    dispatch(LinkFamilyMember({ email, phone, relationToPatient }));
    setSubmitted(true);
  };

  useEffect(() => {
    if (!loading && familyMember && submitted) {
      setSuccess("Family member added successfully");
      setVisible(false);
      setSubmitted(false);
      setRelationToPatient("");
      setCred("");
      // Trigger onSuccess if provided
    } else if (!loading && error & submitted) {
      setSubmitted(false);
      setError("Error adding family member");
    }
  }, [loading, familyMember, setSuccess, setError]);

  return (
    <div className="p-4 mt-4">
      {/* <h2 className="text-2xl font-bold mb-4">Link Family Member</h2> */}

      <form onSubmit={handleSubmit}>
        <TextInput
          className="mb-4"
          placeholder="Enter email or phone number"
          value={cred}
          onChange={(e) => setCred(e.target.value)}
          error={cred && !isValidCred(cred)}
          errorMessage="Please enter a valid email or phone number"
          required
        />

        <Select
          placeholder="Relation to patient"
          onChange={(e) => {
            console.log(e);
            setRelationToPatient(e);
          }}
          required
          name=""
          value={relationToPatient}
        >
          <SelectItem value="">Choose...</SelectItem>
          <SelectItem value="wife">Wife</SelectItem>
          <SelectItem value="husband">Husband</SelectItem>
          <SelectItem value="child">Child</SelectItem>
        </Select>

        <Button type="submit" className="mt-4" loading={loading}>
          Link Member
        </Button>
      </form>
    </div>
  );
}

export default LinkFamily;
```

</details>

<details>
    
<summary> Get Health Packages Reducer </summary>

```javascript
export const getHealthPackagesReducer = (state = getHealthPackagesInitialState, action) => {
    switch (action.type) {
        case HEALTH_PACKAGES_LIST_REQUEST:
            return {
                ...state,
                loading: true,
                error: null,
            };
        case HEALTH_PACKAGES_LIST_SUCCESS: {
            return {
                ...state,
                healthPackages: action.payload,
                loading: false,
                error: null,
            }
        };
        case HEALTH_PACKAGES_LIST_FAIL:
            return {
                ...state,
                loading: false,
                error: action.payload,
            };
        default:
            return state;
    }
}
```

</details>

## API Reference

<details>
<summary>Webhooks</summary>
- **POST /webhook**
  Handles Stripe webhook events.
  </details>

<details>
<summary>Patient Routes</summary>

- **GET /api/v1/patient/auth**
  Authenticates a patient.
- **GET /api/v1/patient/view-Patients**
  Views patient information.
- **GET /api/v1/patient**
  Retrieves all patients (Admin only).
- **GET /api/v1/patient/viewHealthPackageSubscription/:id**
  Views health package subscription details.
- **POST /api/v1/patient/upload/healthRecords/:id**
  Uploads health records.
- **GET /api/v1/patient/viewHealthRecords**
  Retrieves health records.
- **GET /api/v1/patient/cancelSubscription/:id**
  Cancels subscription.
- **GET /api/v1/patient/getPatient/:id**
  Retrieves patient details.
- **GET /api/v1/patient/prescription**
  Retrieves all prescriptions.
- **GET /api/v1/patient/prescription/:id**
  Retrieves specific prescription.
- **GET /api/v1/patient/my-details**
  Retrieves patient's details.
- **POST /api/v1/patient/upload/medicalRecords**
  Uploads medical records.
- **GET /api/v1/patient/download**
  Downloads a file.
- **DELETE /api/v1/patient/removeDoc**
  Removes a document.

</details>
<details>
<summary>Doctor Routes</summary>

- **GET /api/v1/doctor/auth**
  Authenticates a doctor.
- **GET /api/v1/doctor**
  Retrieves all doctors.
- **PATCH /api/v1/doctor/updatedoctor**
  Updates doctor's information.
- **PATCH /api/v1/doctor/acceptdoctor/:id**
  Accepts a doctor.
- **PATCH /api/v1/doctor/rejectdoctor/:id**
  Rejects a doctor.
- **GET /api/v1/doctor/viewcontract**
  Views employment contract.
- **PATCH /api/v1/doctor/acceptcontract**
  Accepts employment contract.
- **PATCH /api/v1/doctor/addavailabledate**
  Adds an available date.
- **GET /api/v1/doctor/doctorDocs/:id**
  Retrieves doctor's documents.
- **GET /api/v1/doctor/getAllDoctors**
  Retrieves all doctors for a patient.
- **GET /api/v1/doctor/specialities**
  Lists all specialities.
- **GET /api/v1/doctor/:id**
  Retrieves specific doctor.
- **GET /api/v1/doctor/my-details**
  Retrieves doctor's details.

</details>

<details>
<summary>Appointment Routes</summary>

- **GET /api/v1/appointment/get-patient-appointments**
  Retrieves all patient appointments.
- **GET /api/v1/appointment/get-doctor-appointments**
  Retrieves all doctor appointments.
- **GET /api/v1/appointment/:id**
  Retrieves specific appointment.
- **POST /api/v1/appointment/newAppointment**
  Creates a new appointment.
- **POST /api/v1/appointment/followUp**
  Follows up an appointment.
- **PATCH /api/v1/appointment/reschedule/:id**
  Reschedules an appointment.
- **PATCH /api/v1/appointment/cancel/:id**
  Cancels an appointment.
- **PATCH /api/v1/appointment/update/:id**
  Updates an appointment.
- **POST /api/v1/appointment/evaluateFollowUp/:id**
  Evaluates follow-up.
- **DELETE /api/v1/appointment/delete/:id**
  Deletes an appointment.
- **GET /api/v1/appointment/reserveStripe/:id/:price**
  Gets checkout session for Stripe.
- **POST /api/v1/appointment/reserve/:id/:price**
  Creates appointment reservation.

</details>
<details>
<summary>Family Member Routes</summary>

- **POST /api/v1/familyMembers/link**
  Links a family member.
- **POST /api/v1/familyMembers**
  Adds family members.
- **GET /api/v1/familyMembers**
  Retrieves registered family members.
- **GET /api/v1/familyMembers/view-all-family-members**
  Retrieves all family members and patients.

</details>

<details>
<summary>Prescription Routes</summary>

- **POST /api/v1/prescriptions/addPrescription**
  Adds a prescription.
- **PATCH /api/v1/prescriptions/update/:id**
  Updates a prescription.
- **GET /api/v1/prescriptions/download/:id**
  Downloads a prescription.
- **POST /api/v1/prescriptions/check**
  Checks a prescription.

</details>

<details>
<summary>Health Packages Routes</summary>

- **GET /api/v1/healthPackages/discount**
  Retrieves discount information.
- **GET /api/v1/healthPackages**
  Retrieves all health packages.
- **POST /api/v1/healthPackages**
  Creates a health package.
- **GET /api/v1/healthPackages/subscribeStripe/:id**
  Retrieves Stripe checkout session.
- **POST /api/v1/healthPackages/subscribe/:id**
  Creates order for health package.
- **GET /api/v1/healthPackages/:id**
  Retrieves specific health package.
- **PATCH /api/v1/healthPackages/:id**
  Updates a health package.
- **DELETE /api/v1/healthPackages/:id**
  Deletes a health package.
- **GET /api/v1/healthPackages/services**
  Retrieves all health package services.

</details>

<details>
<summary>Authentication Routes</summary>

- **GET /api/v1/auth/auth**
  Authenticates user.
- **POST /api/v1/auth/signup**
  Signs up a user.
- **POST /api/v1/auth/login**
  Logs in a user.
- **GET /api/v1/auth**
  Retrieves all users.
- **POST /api/v1/auth/forgotPassword**
  Sends password reset link.
- **PATCH /api/v1/auth/resetPassword**
  Resets password.
- **PATCH /api/v1/auth/changePassword**
  Changes password.
- **POST /api/v1/auth/logout**
  Logs out user.

</details>

<details>
<summary>Notification Routes</summary>

- **PATCH /api/v1/notifications/:id**
  Updates a notification.
- **GET /api/v1/notifications**
  Retrieves notifications.

</details>

<details>
<summary>Message Routes</summary>

- **POST /api/v1/messages/createMessage**
  Creates a message.
- **GET /api/v1/messages/getMessages/:id**
  Retrieves messages.

</details>

<details>
<summary>Chat Routes</summary>

- **GET /api/v1/chats/getChats/:id**
  Retrieves chats.
- **POST /api/v1/chats/createChat**
  Creates a chat.

</details>

for more details refer to the [postman collection](./Elha2ny.postman_collection.json)

## Running Tests

We used [Postman](./Elha2ny.postman_collection.json) for API testing. We also tested the UI by trying to perform every action, and see the results, also by assessing the design and theme.

## Installation

Install with `npm`

```bash
> git clone https://github.com/advanced-computer-lab-2023/ay-haga-Clinic.git
> cd ay-haga-clinic/
> cd backend && npm i
> cd newfrontend && npm i
```

Frontend Dependencies

```bash
 "dependencies": {
    "@heroicons/react": "^2.0.18",
    "@material-tailwind/react": "^2.1.5",
    "@reduxjs/toolkit": "^1.9.5",
    "@stripe/stripe-js": "^2.2.0",
    "@tremor/react": "^3.5.0",
    "autoprefixer": "10.4.14",
    "axios": "^1.6.2",
    "eslint": "8.45.0",
    "eslint-config-next": "13.4.12",
    "heroicons": "^2.0.18",
    "lottie-react": "^2.4.0",
    "next": "13.4.12",
    "postcss": "8.4.27",
    "react": "18.2.0",
    "react-datetime-picker": "^5.6.0",
    "react-dom": "18.2.0",
    "react-icons": "^4.12.0",
    "react-ios-time-picker": "^0.2.2",
    "react-redux": "^8.1.3",
    "react-select": "^5.8.0",
    "simple-peer": "^9.11.1",
    "socket.io-client": "^4.7.2",
    "stripe": "^14.8.0",
    "tailwindcss": "3.3.3",
    "timeago.js": "^4.0.2"
  }
```

Backend Dependencies

```bash
 {
  "dependencies": {
    "archiver": "^6.0.1",
    "axios": "^1.6.2",
    "bcryptjs": "^2.4.3",
    "compression": "^1.7.4",
    "cookie-parser": "^1.4.4",
    "cors": "^2.8.5",
    "dotenv": "^7.0.0",
    "express": "^4.16.4",
    "express-mongo-sanitize": "^1.3.2",
    "express-rate-limit": "^3.5.0",
    "express-validator": "^7.0.1",
    "helmet": "^3.16.0",
    "hpp": "^0.2.2",
    "html-to-text": "^5.1.1",
    "jsonwebtoken": "^8.5.1",
    "mongoose": "^5.5.2",
    "morgan": "^1.9.1",
    "multer": "^1.4.4",
    "node-mailjet": "^6.0.5",
    "nodemailer": "^6.1.1",
    "nodemon": "^3.0.1",
    "pdfkit": "^0.14.0",
    "pug": "^2.0.3",
    "sharp": "^0.30.7",
    "slugify": "^1.3.4",
    "socket.io": "^4.7.2",
    "stripe": "^7.63.1",
    "validator": "^10.11.0",
    "xss-clean": "^0.1.1"
  },
  "devDependencies": {
    "eslint": "^5.16.0",
    "eslint-config-airbnb": "^17.1.0",
    "eslint-config-prettier": "^4.1.0",
    "eslint-plugin-import": "^2.17.2",
    "eslint-plugin-jsx-a11y": "^6.2.1",
    "eslint-plugin-node": "^8.0.1",
    "eslint-plugin-prettier": "^3.0.1",
    "eslint-plugin-react": "^7.12.4",
    "prettier": "^1.17.0"
  },
}
```

Make sure to configure the following environment variables in your `config.env` file in  the backend directory:

- **NODE_ENV**: Set to "development" for the development environment.
- **PORT**: Port on which the server will run (e.g., 8000).
- **DATABASE**: MongoDB database connection URI.
- **DATABASE_PASSWORD**: Password for the MongoDB database.
- **JWT_SECRET**: Secret key for JWT token generation.
- **JWT_EXPIRES_IN**: JWT token expiration time (e.g., "90d" for 90 days).
- **JWT_COOKIES_EXPIRES_IN**: JWT cookie expiration time (e.g., "90").
- **EMAIL_USERNAME**: SMTP email username.
- **EMAIL_PASSWORD**: SMTP email password.
- **EMAIL_PORT**: SMTP email port.
- **EMAIL_HOST**: SMTP email host.
- **EMAIL_FROM**: Default "from" email address for outgoing emails.
- **SENDGRID_USERNAME**: SendGrid API username.
- **SENDGRID_PASSWORD**: SendGrid API password.
- **STRIPE_SECRET_KEY**: Stripe secret API key.
- **STRIPE_WEBHOOK_SECRET**: Stripe webhook secret.

## How To Use

```bash
> git clone https://github.com/advanced-computer-lab-2023/ay-haga-Clinic.git
> cd ay-haga-clinic/
```

#### Configuration Variables

<details> <summary> Make sure to configure the following environment variables in your `config.env` file: </summary>

- **NODE_ENV**: Set to "development" for the development environment.
- **PORT**: Port on which the server will run (e.g., 8000).
- **DATABASE**: MongoDB database connection URI.
- **DATABASE_PASSWORD**: Password for the MongoDB database.
- **JWT_SECRET**: Secret key for JWT token generation.
- **JWT_EXPIRES_IN**: JWT token expiration time (e.g., "90d" for 90 days).
- **JWT_COOKIES_EXPIRES_IN**: JWT cookie expiration time (e.g., "90").
- **EMAIL_USERNAME**: SMTP email username.
- **EMAIL_PASSWORD**: SMTP email password.
- **EMAIL_PORT**: SMTP email port.
- **EMAIL_HOST**: SMTP email host.
- **EMAIL_FROM**: Default "from" email address for outgoing emails.
- **SENDGRID_USERNAME**: SendGrid API username.
- **SENDGRID_PASSWORD**: SendGrid API password.
- **STRIPE_SECRET_KEY**: Stripe secret API key.
- **STRIPE_WEBHOOK_SECRET**: Stripe webhook secret.
</details>

Then open 2 terminals

write the following in the first one:

```bash
> cd backend
> npm install
> npm start
```

write the following in the second one:

```bash
> cd newfrontend
> npm install
> npm run dev
```

## Contributing

Contributions are always welcome!
Contribution guidelines highlighting areas for improvement such as:

- Implementing responsive design for different device sizes.
- Using Mailjet templates for email communications.
- Optimizing heavy endpoints with NoSQL queries instead of manual looping.

## Credits

Acknowledgment of resources and tutorials that assisted in the project development:

- [Udemy courses for JavaScript and Node.js](https://www.udemy.com/course/nodejs-express-mongodb-bootcamp/)
- [YouTube tutorials](https://www.youtube.com/@NetNinja)
- [ChatGPT](https://chat.openai.com/)
- [Stack Overflow](https://stackoverflow.com/)
- Technologies Documentations

## License

- [stripe](https://stripe.com/)
- [MIT](https://opensource.org/license/mit/)
- [Apache-2.0](https://www.apache.org/)
- [mailjet](https://www.mailjet.com/)
- [mailtrap](https://mailtrap.io/)
